# Cache Prevention for Dynamic Content
# Prevent caching of main HTML file
<Files "index.html">
    Header always set Cache-Control "no-cache, no-store, must-revalidate"
    Header always set Pragma "no-cache" 
    Header always set Expires "0"
</Files>

# Prevent caching of JavaScript data files that change frequently
<FilesMatch "\.(js)$">
    # Check if it's our dynamic content files
    SetEnvIf Request_URI "(episodes|website-data)\.js" dynamic_content
    Header always set Cache-Control "no-cache, no-store, must-revalidate" env=dynamic_content
    Header always set Pragma "no-cache" env=dynamic_content
    Header always set Expires "0" env=dynamic_content
</FilesMatch>

# Allow longer caching for static assets (fonts, images, etc.)
<FilesMatch "\.(css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
    # Only cache if not being cache-busted
    SetEnvIf Query_String "nocache" no_cache_asset
    Header unset Cache-Control env=no_cache_asset
    Header unset Pragma env=no_cache_asset
    Header unset Expires env=no_cache_asset
    Header always set Cache-Control "no-cache, no-store, must-revalidate" env=no_cache_asset
    
    # Normal caching for non-cache-busted assets
    Header set Cache-Control "public, max-age=31536000" env=!no_cache_asset
</FilesMatch>

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# GZIP Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# PHP Configuration for CRM
<IfModule mod_php.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value max_input_time 300
    php_value memory_limit 256M
</IfModule>

# Prevent access to sensitive files
<FilesMatch "\.(md|json|db|log)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Allow access to podcast-crm directory
<Directory "podcast-crm">
    Order allow,deny
    Allow from all
</Directory>